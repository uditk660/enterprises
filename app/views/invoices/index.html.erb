<div class="company-page">

  <div class="company-glass-card">

    <!-- ===== HEADER ===== -->
    <div class="company-list-header invoice-header">
      <div>
        <h2>Invoices</h2>
        <p>All invoices generated for customers</p>
      </div>

      <div class="invoice-header-actions">

        <!-- SEARCH (INLINE, NO LAYOUT SHIFT) -->
        <%= form_tag invoices_path, method: :get, class: "invoice-search-form" do %>
          <%= text_field_tag :q, params[:q], placeholder: "Search invoice / customer", class: "invoice-search-input" %>

          <button type="submit" class="invoice-search-btn" title="Search">
            üîç
          </button>

          <% if params[:q].present? || params[:sort].present? %>
            <%= link_to "Reset", invoices_path, class: "invoice-reset-link" %>
          <% end %>
        <% end %>

        <%= link_to "New Invoice",
              new_invoice_path,
              class: "primary-btn" %>
      </div>
    </div>

    <!-- ===== TABLE ===== -->
    <div class="table-wrapper">
      <table class="enterprise-table">
        <thead>
          <tr>
            <th>#</th>
            <th><%= sort_link "Invoice Number", "invoice_number" %></th>
            <th><%= sort_link "Date", "invoice_date" %></th>
            <th>Item</th>
            <th><%= sort_link "Customer", "customers.name" %></th>
            <th>Destination</th>
            <th>Weight</th>
            <th><%= sort_link "Amount", "total_amount" %></th>
            <th class="text-end">Actions</th>
          </tr>
        </thead>

        <tbody>
          <% index = 1 %>

          <% @invoices.each do |invoice| %>
            <% invoice.invoice_items.each do |item| %>
              <tr>
                <td><%= index %></td>
                <td>
                  <strong><%= invoice.invoice_number %></strong>
                </td>
                <td>
                  <%= invoice.invoice_date.strftime("%d-%b-%Y") %>
                </td>
                <td>
                  <%= item.product_name %>
                </td>
                <td>
                  <%= invoice.customer.name %>
                </td>
                <td>
                  <%= item.destination %>
                </td>
                <td>
                  <%= "#{item.weight} #{item.weight_unit}" %>
                </td>
                <td>
                  <%= number_to_currency(item.amount, unit: "‚Çπ") %>
                </td>
                <td class="text-end">
                  <%= link_to "Show",
                        invoice_path(invoice),
                        class: "table-btn view-btn" %>

                  <%= link_to "Edit",
                        edit_invoice_path(invoice),
                        class: "table-btn edit-btn" %>

                  <%= link_to "Delete",
                        invoice_path(invoice),
                        method: :delete,
                        data: { confirm: "Are you sure?" },
                        class: "table-btn delete-btn" %>
                </td>
              </tr>

              <% index += 1 %>
            <% end %>
          <% end %>

          <% if @invoices.empty? %>
            <tr>
              <td colspan="9" class="empty-state">
                No invoices found. Click ‚ÄúNew Invoice‚Äù to create one.
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>

    <!-- ===== PAGINATION ===== -->
    <div class="pagination-wrapper mt-4">
      <%= paginate @invoices %>
    </div>

  </div>

</div>
